<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      nav {
        position: fixed;
        background: white;
        right: 200px;
      }
      h1 {
        font-size: 16px;
        flex-basis: 100%;
      }
      section {
        display: flex;
        flex-flow: row wrap;
      }
      figure {
        width: 96px;
        margin: 8px;
      }
      figcaption {
        text-align: center;
        color: #222;
        font-size: smaller;
      }
      a:link,
      a:visited {
        text-decoration: none;
      }
      .grouped {
        border: 1px solid #ccc;
        display: inherit;
        flex-flow: row wrap;
      }
      .multicolor {
        background: linear-gradient(0deg, #a0a5a9 25%, #c91a09 90%);
      }
      img {
        height: 96px;
        display: block;
        color: #eee;
        text-shadow: 1px 1px black;
      }
    </style>
  </head>

  <body>
    <nav>
      <input id="filter" placeholder="Filter..." />
      <input id="captions" type="checkbox" /><label for="captions">Captions</label>
      <input id="prints" type="checkbox" /><label for="captions">Prints</label>
      <input id="unsorted" type="checkbox" /><label for="captions">Unsorted</label>
      <input id="legacy" type="checkbox" /><label for="captions">Legacy</label>
    </nav>

    <section>{{ figures }}</section>

    <script>
      const filter = query => {
        document.querySelectorAll('section').forEach(el => (el.style.display = 'none'))

        document.querySelectorAll('figure').forEach(fig => {
          if (!query) {
            fig.style.display = 'inline-block'
            return
          }

          let keywords = fig.querySelector('img').title.toLowerCase().split(/ +/)

          let match = query
            .toLowerCase()
            .split(/ +/)
            .every(kw => keywords.includes(kw))

          fig.style.display = match ? 'inline-block' : 'none'

          if (match) {
            fig.parentNode.style.display = 'flex'
          }
        })
      }

      document.querySelector('input#filter').addEventListener('input', e => {
        filter(e.target.value)
      })

      document.querySelector('input#captions').addEventListener('input', e => {
        document.querySelectorAll('figcaption').forEach(cap => {
          cap.style.display = captions.checked ? 'block' : 'none'
        })
      })
      captions.dispatchEvent(new Event('input'))

      legacy.addEventListener('input', e => {
        document.querySelector('section:nth-last-child(4)').style.display = legacy.checked
          ? 'flex'
          : 'none'
      })
      legacy.dispatchEvent(new Event('input'))

      prints.addEventListener('input', e => {
        document.querySelector('section:nth-last-child(3)').style.display = prints.checked
          ? 'flex'
          : 'none'
      })
      prints.dispatchEvent(new Event('input'))

      unsorted.addEventListener('input', e => {
        document.querySelector('section:nth-last-child(2)').style.display = unsorted.checked
          ? 'flex'
          : 'none'
      })
      unsorted.dispatchEvent(new Event('input'))
    </script>
  </body>
</html>
