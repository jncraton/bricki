<html>
<head>
<style>
* {
  font-size:24px;
  font-family:sans;
}
body {
  margin: 0 auto;
  padding: 5em;
  width: 800px;
}
section#part_search tr:not(:first-child) {
  opacity:.5;
}
img {
  width:85px;
  height:85px;
}
input, button {
  display:block;
}
</style>
</head>
<body>
<section>
<input type=number value=1 />
<input list="colors" name="color" />
<datalist id="colors">
</datalist>
<input name=part_search placeholder="Part name..."></input>
<button>Add</button>

<section id=part_search>
<table><tbody id=part_results></tbody></table>
</section>

<section>
  <h2>Recent</h2>
  <table><tbody id=recent></tbody></table>
</section>
<script>
function getImg(part_num, color_id) {
  return `https://cdn.rebrickable.com/media/thumbs/parts/ldraw/${color_id}/${part_num}.png/85x85p.png`
}

async function update_recent() {
  let recent_response = await fetch('/recent')
  let transactions = await recent_response.json()

  document.querySelector('#recent').innerHTML = ''
  transactions.forEach(tx => {
    document.querySelector('#recent').innerHTML += `<tr><td><img src="${getImg(tx.part_num, tx.color_id)}"/><td>${tx.quantity}<td>${tx.color}<td>${tx.part}<td>${tx.part_num}</tr>`
  })
}

document.querySelector("input[name=part_search]").addEventListener('input', async (e) => {
  let parts_response = await fetch('/search_part?q=' + document.querySelector("input[name=part_search]").value)
  let parts = await parts_response.json()
  document.querySelector('#part_results').innerHTML = ''
  parts.forEach(part => {
    document.querySelector('#part_results').innerHTML += `<tr><td><img src="${getImg(part.part_num, 71)}"/><td>${part.part_name}</tr>`
  })
})

async function init() {
  let colors_response = await fetch('/colors')
  let colors = await colors_response.json()

  document.querySelector('#colors').innerHTML = ''
  colors.forEach(color => {
    document.querySelector('#colors').innerHTML += `<option value="${color}">`
  })

  update_recent()
}

init()
</script>
</body>
</html>