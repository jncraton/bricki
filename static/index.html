<html>
<head>
<style>
* {
  font-size:24px;
  font-family:sans;
}
body {
  margin: 0 auto;
  padding: 5em;
  width: 800px;
}
section#part_search tr:not(:first-child) {
  opacity:.5;
}
</style>
</head>
<body>
<section id=part_search>
<input name=part_search placeholder="Part name..."></input>
  <table><tbody id=part_results></tbody></table>
</section>
<section>
  <h2>Recent</h2>
  <table><tbody id=recent></tbody></table>
</section>
<script>
function getImg(part_num, color_id) {
  return `https://cdn.rebrickable.com/media/thumbs/parts/ldraw/${color_id}/${part_num}.png/85x85p.png`
}

async function update() {
  let recent_response = await fetch('/recent')
  let transactions = await recent_response.json()

  document.querySelector('#recent').innerHTML = ''
  transactions.forEach(tx => {
    document.querySelector('#recent').innerHTML += `<tr><td><img src="${getImg(tx.part_num, tx.color_id)}"/><td>${tx.quantity}<td>${tx.color}<td>${tx.part}<td>${tx.part_num}</tr>`
  })

  let parts_response = await fetch('/search_part?q=' + document.querySelector("input[name=part_search]").value)
  let parts = await parts_response.json()
  document.querySelector('#part_results').innerHTML = ''
  parts.forEach(part => {
    document.querySelector('#part_results').innerHTML += `<tr><td><img src="${getImg(part.part_num, 71)}"/><td>${part.part_name}</tr>`
  })
}

document.querySelector("input[name=part_search]").addEventListener('input', (e) => {
  console.log(e.target.value)
  update()
})

update()
</script>
</body>
</html>